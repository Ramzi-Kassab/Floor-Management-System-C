# Generated by Django 5.2.6 on 2025-11-23 04:51

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("production", "0006_add_unique_phone_to_employee"),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name="BOMItem",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "item_type",
                    models.CharField(
                        choices=[
                            ("CUTTER", "PDC Cutter"),
                            ("NOZZLE", "Nozzle"),
                            ("BEARING", "Bearing"),
                            ("SEAL", "Seal"),
                            ("HARDFACING", "Hardfacing Material"),
                            ("POWDER", "Matrix Powder"),
                            ("BINDER", "Binder/Infiltrant"),
                            ("THREAD_COMPOUND", "Thread Compound"),
                            ("OTHER", "Other Component"),
                        ],
                        db_index=True,
                        max_length=50,
                    ),
                ),
                (
                    "part_number",
                    models.CharField(
                        help_text="Manufacturer part number", max_length=100
                    ),
                ),
                ("description", models.TextField()),
                (
                    "quantity",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Quantity required per bit",
                        max_digits=10,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "unit",
                    models.CharField(
                        default="EA",
                        help_text="Unit of measure (EA, LB, KG, etc.)",
                        max_length=20,
                    ),
                ),
                ("manufacturer", models.CharField(blank=True, max_length=200)),
                (
                    "grade",
                    models.CharField(
                        blank=True,
                        help_text="Material grade or specification",
                        max_length=100,
                    ),
                ),
                (
                    "is_critical",
                    models.BooleanField(
                        default=False,
                        help_text="Critical component requiring special tracking",
                    ),
                ),
                ("notes", models.TextField(blank=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "design_revision",
                    models.ForeignKey(
                        help_text="Design this BOM applies to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="bom_items",
                        to="production.bitdesignrevision",
                    ),
                ),
            ],
            options={
                "ordering": ["item_type", "part_number"],
            },
        ),
        migrations.CreateModel(
            name="ActualBOM",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "planned_quantity",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Planned quantity from BOM",
                        max_digits=10,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "actual_quantity",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Actual quantity used",
                        max_digits=10,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "lot_number",
                    models.CharField(
                        blank=True,
                        help_text="Lot/batch number of material used",
                        max_length=100,
                    ),
                ),
                (
                    "serial_numbers",
                    models.TextField(
                        blank=True,
                        help_text="Serial numbers of critical components (one per line)",
                    ),
                ),
                (
                    "variance_notes",
                    models.TextField(
                        blank=True,
                        help_text="Notes on quantity variance or substitutions",
                    ),
                ),
                ("recorded_at", models.DateTimeField(auto_now_add=True)),
                (
                    "recorded_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="bom_records",
                        to="production.employee",
                    ),
                ),
                (
                    "work_order",
                    models.ForeignKey(
                        help_text="Work order this BOM applies to",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="actual_bom",
                        to="production.workorder",
                    ),
                ),
                (
                    "bom_item",
                    models.ForeignKey(
                        help_text="Reference BOM item",
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="actual_usage",
                        to="production.bomitem",
                    ),
                ),
            ],
            options={
                "ordering": ["work_order", "bom_item"],
            },
        ),
        migrations.CreateModel(
            name="RepairDecision",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("needs_cutter_replacement", models.BooleanField(default=False)),
                ("needs_nozzle_replacement", models.BooleanField(default=False)),
                ("needs_hardfacing", models.BooleanField(default=False)),
                ("needs_thread_repair", models.BooleanField(default=False)),
                ("needs_gauge_repair", models.BooleanField(default=False)),
                ("needs_balance", models.BooleanField(default=False)),
                ("needs_ndt", models.BooleanField(default=False)),
                (
                    "estimated_hours",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Estimated repair hours",
                        max_digits=6,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "estimated_cutter_count",
                    models.PositiveIntegerField(
                        default=0, help_text="Estimated cutters to replace"
                    ),
                ),
                (
                    "decision_notes",
                    models.TextField(
                        blank=True, help_text="Reasoning for route selection"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="repair_decisions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "evaluation_summary",
                    models.OneToOneField(
                        help_text="Evaluation this decision is based on",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="repair_decision",
                        to="production.evaluationsummary",
                    ),
                ),
                (
                    "recommended_route",
                    models.ForeignKey(
                        blank=True,
                        help_text="Recommended route template",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="recommended_for",
                        to="production.routetemplate",
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="RepairHistory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "repair_index",
                    models.PositiveIntegerField(
                        help_text="Repair number (1=R1, 2=R2, etc.)"
                    ),
                ),
                (
                    "hours_on_bit",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Hours bit was in use",
                        max_digits=10,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "footage_drilled",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Footage drilled before return",
                        max_digits=10,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "damage_description",
                    models.TextField(
                        blank=True, help_text="Description of damage observed"
                    ),
                ),
                (
                    "cutters_replaced",
                    models.PositiveIntegerField(
                        default=0, help_text="Number of PDC cutters replaced"
                    ),
                ),
                (
                    "nozzles_replaced",
                    models.PositiveIntegerField(
                        default=0, help_text="Number of nozzles replaced"
                    ),
                ),
                (
                    "hardfacing_applied",
                    models.BooleanField(
                        default=False, help_text="Was hardfacing reapplied"
                    ),
                ),
                (
                    "threads_repaired",
                    models.BooleanField(
                        default=False, help_text="Were threads repaired/re-cut"
                    ),
                ),
                (
                    "gauge_repaired",
                    models.BooleanField(
                        default=False, help_text="Was gauge repaired/rebuilt"
                    ),
                ),
                (
                    "balance_check",
                    models.BooleanField(default=False, help_text="Was bit re-balanced"),
                ),
                ("repair_completed_date", models.DateField(blank=True, null=True)),
                (
                    "repair_notes",
                    models.TextField(
                        blank=True, help_text="General notes about this repair cycle"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "bit_instance",
                    models.ForeignKey(
                        help_text="Bit that was repaired",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="repair_history",
                        to="production.bitinstance",
                    ),
                ),
                (
                    "evaluation_summary",
                    models.ForeignKey(
                        blank=True,
                        help_text="Evaluation that triggered this repair",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="repair_from_eval",
                        to="production.evaluationsummary",
                    ),
                ),
                (
                    "previous_repair",
                    models.ForeignKey(
                        blank=True,
                        help_text="Previous repair in the chain",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="subsequent_repairs",
                        to="production.repairhistory",
                    ),
                ),
                (
                    "route_template_used",
                    models.ForeignKey(
                        blank=True,
                        help_text="Route template used for this repair",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="repair_usage",
                        to="production.routetemplate",
                    ),
                ),
                (
                    "work_order",
                    models.OneToOneField(
                        help_text="Repair work order",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="repair_record",
                        to="production.workorder",
                    ),
                ),
            ],
            options={
                "verbose_name_plural": "Repair histories",
                "ordering": ["bit_instance", "repair_index"],
            },
        ),
        migrations.AddIndex(
            model_name="bomitem",
            index=models.Index(
                fields=["design_revision", "item_type"],
                name="production__design__268ddc_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="bomitem",
            index=models.Index(
                fields=["part_number"], name="production__part_nu_664f28_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="actualbom",
            index=models.Index(
                fields=["work_order", "bom_item"], name="production__work_or_b8842f_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="repairhistory",
            index=models.Index(
                fields=["bit_instance", "repair_index"],
                name="production__bit_ins_29d56c_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="repairhistory",
            index=models.Index(
                fields=["work_order"], name="production__work_or_66eb54_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="repairhistory",
            unique_together={("bit_instance", "repair_index")},
        ),
    ]
