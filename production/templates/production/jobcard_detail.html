{% extends 'production/base.html' %}
{% block title %}{{ jobcard.jobcard_code }}{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col-md-6"><h1><i class="bi bi-card-checklist"></i> Job Card: {{ jobcard.jobcard_code }}</h1></div>
    <div class="col-md-6 text-end">
        <a href="{% url 'production:jobcard-qr' jobcard.pk %}" class="btn btn-success" target="_blank"><i class="bi bi-qr-code"></i> QR Code</a>
        <a href="{% url 'production:jobcard-edit' jobcard.pk %}" class="btn btn-warning"><i class="bi bi-pencil"></i> Edit</a>
        <a href="{% url 'production:jobcard-list' %}" class="btn btn-secondary">Back</a>
    </div>
</div>
<div class="row">
    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-header"><h5>Job Card Details</h5></div>
            <div class="card-body">
                <p><strong>Job Card Code:</strong> {{ jobcard.jobcard_code }}</p>
                <p><strong>Work Order:</strong> <a href="{% url 'production:workorder-detail' jobcard.work_order.pk %}">{{ jobcard.work_order.wo_number }}</a></p>
                <p><strong>Department:</strong> {{ jobcard.get_department_display|default:"—" }}</p>
                <p><strong>Status:</strong> <span class="badge bg-primary">{{ jobcard.get_status_display }}</span></p>
                <p><strong>Type:</strong> {% if jobcard.is_repair %}<span class="badge bg-warning">Repair</span>{% else %}<span class="badge bg-info">New Build</span>{% endif %}</p>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><h5>Route Steps ({{ route_steps.count }})</h5></div>
            <div class="card-body">
                {% if route_steps %}
                <table class="table table-sm">
                    <thead><tr><th>#</th><th>Process</th><th>Department</th><th>Status</th></tr></thead>
                    <tbody>
                        {% for step in route_steps %}
                        <tr>
                            <td>{{ step.sequence }}</td>
                            <td>{{ step.process_code }}</td>
                            <td>{{ step.get_department_display|default:"—" }}</td>
                            <td><span class="badge bg-secondary">{{ step.get_status_display }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted">No route steps defined.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header"><h6>QR Code</h6></div>
            <div class="card-body text-center">
                <img src="{% url 'production:jobcard-qr' jobcard.pk %}" alt="QR Code" class="img-fluid" style="max-width: 200px;">
                <p class="mt-2 small text-muted">Scan to access this job card</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
